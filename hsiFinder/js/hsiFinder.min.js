var APP_EVENT_TYPE="hsi_service_benefit",EVENT_TYPE_APPROVE_STATUS="APR",API_HOST="https://was8-inter-dev.toronto.ca",gblJSONData="",gblFilteredData=[],gblBaselineCnt=0,gblRules=[{text:"Select Rule...",value:""},{text:"RESIDENT: Toronto Resident",value:"Resident"},{text:"RESIDENT: Toronto Non-Resident",value:"Non-Resident"},{text:"AGE: Age Group 1 (0-17)",value:"Age 0-17"},{text:"AGE: Age Group 2 (18-29)",value:"Age 18-29"},{text:"AGE: Age Group 3 (30-59)",value:"Age 30-59"},{text:"AGE: Age Group 4 (60-65)",
value:"Age 60-65"},{text:"AGE: Age Group 5 (65+)",value:"Age 65+"},{text:"FINANCIAL NEED: Yes",value:"Financial Need"},{text:"FINANCIAL NEED: No",value:"No Financial Need"},{text:"FINANCIAL NEED: Don't Know",value:"Unsure Financial Need"},{text:"RECIPIENT: Ontario Works",value:"OW"},{text:"RECIPIENT: Ontario Disability Support",value:"ODSP"},{text:"RECIPIENT: NOT Ontario Disability Support",value:"NOT ODSP"},{text:"RECIPIENT: Subsidized Housing/Rent",value:"Subsidized Housing"},{text:"CHILDREN: All Age Groups",
value:"Has Children"},{text:"CHILDREN: Age Group 1 (12 and under)",value:"Child Ages 12 and under"},{text:"CHILDREN: Age Group 2 (13-17)",value:"Child Ages 13-17"},{text:"CHILDREN: Age Group 3 (expecting)",value:"Expecting Child"},{text:"EMPLOYMENT: Looking for Work",value:"Looking For Work"},{text:"EMPLOYMENT: Looking to Upgrade Skills",value:"Looking To Upgrade"},{text:"HOUSING: Own",value:"Home Owner"},{text:"HOUSING: Rent",value:"Renter"},{text:"HOUSING: Homeless",value:"Homeless"},{text:"HOUSING: None of the above",
value:"None of the Above"},{text:"HOUSING: Risk of Eviction",value:"Eviction Risk"},{text:"HOUSING: Need Subsidized Housing",value:"Need Subsidized Housing"},{text:"HOUSING: Looking for Housing",value:"Looking for Housing"},{text:"HOUSING: Need Landlord Help",value:"Need Landlord Help"},{text:"HEALTH/HOME NEED: Medical",value:"Medical Need"},{text:"HEALTH/HOME NEED: Home Safety",value:"Home Safety"},{text:"HEALTH/HOME NEED: Home Utilities",value:"Home Utilities"},{text:"SPECIAL NEEDS: Yes",value:"Special Needs Yes"},
{text:"SPECIAL NEEDS: No",value:"Special Needs No"},{text:"OTHER: Conviction",value:"Conviction Issue"},{text:"OTHER: Funeral Cost",value:"Funeral Cost"}],questions={};function ApiAlert(a){appAlert(a.type,a.error)}function appAlert(a,b){bootbox.dialog({title:a,message:b,buttons:{success:{label:"OK",className:"btn-success"}}})}
function dynamicSort(a,b){var c=1;"-"===b[0]&&(c=-1,b=b.substr(1));return function(d,e){var f=0,f=""!==a?d[a][b].toLowerCase()<e[a][b].toLowerCase()?-1:d[a][b].toLowerCase()>e[a][b].toLowerCase()?1:0:d[b].toLowerCase()<e[b].toLowerCase()?-1:d[b].toLowerCase()>e[b].toLowerCase()?1:0;return f*c}}var app=new cot_app("Service and Benefit Finder Tool");
function setTitle(a){"step0"!==a[0].id?$("#wizardTitle").html(a.attr("data-title")):$("#wizardTitle").html(a.attr("data-title")+"<img src='img/finderTool.png' alt='finder tool logo' height='80px'/>")}
function prevStep(){var a=$(".step.active"),b=$("#step"+(parseInt($(".step.active").attr("data-step"),10)-1).toString()),c=$("#step"+(parseInt($(".step.active").attr("data-step"),10)-2).toString());$("#nextstep").removeClass("hide");a.removeClass("active");b.addClass("active");$("#prevstep").attr("disabled",0===c.length);$("#nextstep").attr("disabled",!1);setTitle(b);updateProgressBar()}
function nextStep(){var a=$(".step.active"),b=$("#step"+(parseInt($(".step.active").attr("data-step"),10)+1).toString()),c=$("#step"+(parseInt($(".step.active").attr("data-step"),10)+2).toString());$("#nextstep").attr("disabled",0===c.length);0===c.length&&($("#nextstep").addClass("hide"),$("#finishstep").removeClass("hide"));a.removeClass("active");b.addClass("active");$("#prevstep").attr("disabled",!1);setTitle(b);updateProgressBar()}
function startStep(){$("#finishstep").addClass("hide");$("#nextstep").removeClass("hide");$("#nextstep").attr("disabled",!1);$("#prevstep").attr("disabled",!1);$("#wizardSummary").addClass("hide");$("#wizard").removeClass("hide");$("#step1").addClass("active");setTitle($("#step1"));updateProgressBar()}
function goToStep(a){$("#nextstep").removeClass("hide");$("#nextstep").attr("disabled",!1);1===a?$("#prevstep").attr("disabled",!0):$("#prevstep").attr("disabled",!1);$("#wizardSummary").addClass("hide");$("#wizard").removeClass("hide");$("#step"+a).addClass("active");setTitle($("#step"+a));updateProgressBar()}function addGotoStep(a){return"<a class='pull-right' data-stepid='"+a+"' href=''><span class='sr-only'>change</span><i title='change' class='glyphicon glyphicon-pencil'></i></a>"}
function finishStep(){setUpQuestionAnswers();var a="<ul>",b=[];$("#maincontent input:checked").each(function(){"undefined"!==typeof $(this).data("qval")&&(questions[$(this).data("qval")]=!0)});var c=1,a=a+(0<$("#torontoresident:checked").length?"<li><span class='label'>Toronto Resident</span>: Yes":""),a=a+(0<$("#nottorontoresident:checked").length?"<li><span class='label'>Toronto Resident</span>: No":""),a=a+(0===$("#torontoresident:checked").length&&0===$("#nottorontoresident:checked").length?"<li class='unspecified'><span class='label'>Toronto Resident</span>: Unspecified":
""),a=a+(addGotoStep(c)+"</li>"),c=2,a=0<$(".filterage input:checked").length?a+("<li><span class='label'>Age</span>: "+$(".filterage input:checked").val()):a+"<li class='unspecified'><span class='label'>Age</span>: Unspecified",a=a+(addGotoStep(c)+"</li>"),c=3,a=a+(0<$("#financialneedyes:checked").length?"<li><span class='label'>In Financial Need</span>: Yes":""),a=a+(0<$("#financialneedno:checked").length?"<li><span class='label'>In Financial Need</span>: No":""),a=a+(0<$("#financialneeddontknow:checked").length?
"<li><span class='label'>In Financial Need</span>: Not Sure":""),a=a+(0===$("#financialneeddontknow:checked").length&&0===$("#financialneedno:checked").length&&0===$("#financialneedyes:checked").length?"<li class='unspecified'><span class='label'>In Financial Need</span>: Unspecified":""),a=a+(addGotoStep(c)+"</li>"),a=a+(0<$("#ow:checked").length?"<li><span class='label'>Recipient of</span>: Ontario Works"+addGotoStep(c)+"</li>":""),a=a+(0<$("#odsp:checked").length?"<li><span class='label'>Recipient of</span>: Ontario Disability Support Program"+
addGotoStep(c)+"</li>":""),a=a+(0<$("#tch:checked").length?"<li><span class='label'>Recipient of</span>: Subsidized Housing/Rent Subsidy"+addGotoStep(c)+"</li>":"");if(0==$("#step3b").find("input:checked").length||0<$("#finNone:checked").length)a+="<li class='noselection'><span class='label'>Financial Need Recipient</span>: No Selections"+addGotoStep(c)+"</li>";0===$("#odsp:checked").length&&(questions["NOT ODSP"]=!0);c=4;b=[];0<$("#childagerange1:checked").length&&b.push($("#childagerange1").val());
0<$("#childagerange2:checked").length&&b.push($("#childagerange2").val());0<$("#childagerange3:checked").length&&b.push($("#childagerange3").val());0<b.length?(a+="<li><span class='label'>Children's Ages</span>: "+b.join(", ")+addGotoStep(c)+"</li>",questions["Has Children"]=!0):a+="<li class='noselection'><span class='label'>Children's Ages</span>: No Selections"+addGotoStep(c)+"</li>";c=5;a+=0<$("#lookingforwork:checked").length?"<li><span class='label'>Employment Status</span>: "+$("#lookingforwork:checked").val()+
addGotoStep(c)+"</li>":"";a+=0<$("#lookingtoupgrade:checked").length?"<li><span class='label'>Employment Status</span>: "+$("#lookingtoupgrade:checked").val()+addGotoStep(c)+"</li>":"";a+=0<$("#eiNone:checked").length?"<li class='noselection'><span class='label'>Employment Status</span>: No Selections"+addGotoStep(c)+"</li>":"";0==$("#step5").find("input:checked").length&&(a+="<li class='noselection'><span class='label'>Employment Status</span>: No Selections"+addGotoStep(c)+"</li>");c=6;a=0<$("input[name='housing']:checked").length?
a+("<li><span class='label'>Housing Status</span>: "+$("input[name='housing']:checked").val()):a+"<li class='unspecified'><span class='label'>Housing Status</span>: Unspecified";a+=addGotoStep(c)+"</li>";a+=0<$("#riskofeviction:checked").length?"<li><span class='label'>Housing Status Other</span>: "+$("#riskofeviction:checked").val()+addGotoStep(c)+"</li>":"";a+=0<$("#needsubsidizedhousing:checked").length?"<li><span class='label'>Housing Status Other</span>: "+$("#needsubsidizedhousing:checked").val()+
addGotoStep(c)+"</li>":"";a+=0<$("#lookingforhousing:checked").length?"<li><span class='label'>Housing Status Other</span>: "+$("#lookingforhousing:checked").val()+addGotoStep(c)+"</li>":"";a+=0<$("#needlandlordhelp:checked").length?"<li><span class='label'>Housing Status Other</span>: "+$("#needlandlordhelp:checked").val()+addGotoStep(c)+"</li>":"";if(0==$("#step6b").find("input:checked").length||0<$("#hsNone:checked").length)a+="<li class='noselection'><span class='label'>Housing Status Other</span>: No Selections"+
addGotoStep(c)+"</li>";c=7;b=0;0<$("#medicalordental:checked").length&&(b++,a+="<li><span class='label'>Health and Home Need</span>: Medical/Dental"+addGotoStep(c)+"</li>");0<$("#homesafety:checked").length&&(b++,a+="<li><span class='label'>Health and Home Need</span>: Home Safety"+addGotoStep(c)+"</li>");0<$("#homeutilities:checked").length&&(b++,a+="<li><span class='label'>Health and Home Need</span>: Home Safety"+addGotoStep(c)+"</li>");0===b&&(a+="<li class='noselection'><span class='label'>Health and Home Need</span>: No Selections"+
addGotoStep(c)+"</li>");c=8;b=0;0<$("#specialneedsYes:checked").length&&(b++,a+="<li><span class='label'>Disability or Special Needs</span>: Yes"+addGotoStep(c)+"</li>");0<$("#specialneedsNo:checked").length&&(b++,a+="<li><span class='label'>Disability or Special Needs</span>: No"+addGotoStep(c)+"</li>");0===b&&(a+="<li class='noselection'><span class='label'>Disability or Special Need</span>: No Selections"+addGotoStep(c)+"</li>");c=9;b=0;0<$("#incarcerated:checked").length&&(b++,a+="<li>About to be or recently released from prison"+
addGotoStep(c)+"</li>");0<$("#funeral:checked").length&&(b++,a+="<li>In need of help to pay for funeral"+addGotoStep(c)+"</li>");0===b&&(a+="<li class='noselection'><span class='label'>Other Information</span>: No Selections"+addGotoStep(c)+"</li>");a+="</ul>";$("#summarydetails").html(a);$("#wizardSummary").removeClass("hide");$(".step").removeClass("active");$("#wizard").addClass("hide");showBaseline();0<$("#summarydetails li.unspecified").length?$("#unspecifiedmsg").removeClass("hide"):$("#unspecifiedmsg").addClass("hide")}
function updateProgressBar(){var a=$(".step").length-1,b=parseInt($(".step.active").attr("data-step"),10),c=Math.round(b/a*100);$("#stepprogress").css("width",c+"%");$("#stepprogress").attr("aria-valuenow",c);$("#stepprogress").html("Step "+b+" of "+a);$("#wizard :input:enabled:visible:first").focus()}function processRule(a){var b="";$.each(a,function(a,d){""!==d.op&&(b+="or"===d.op.toLowerCase()?"||":"&&");b+=questions[d.subrule]});a=!1;try{a=eval(b)}catch(c){a=!1}return a}
function showBaseline(){var a="";gblBaselineCnt=0;gblFilteredData=[];$("#hsi_housing, #hsi_childcare,#hsi_employment, #hsi_benefit, #hsi_medical").html("");$.each(gblJSONData,function(b,d){itemSelect=!1;if("undefined"===typeof d.rules||0===d.rules.length)itemSelect=!0;else{$.each(d.rules,function(a,b){b.ruleStatus=processRule(b.rule)});var e="";$.each(d.rules,function(a,b){e+="AND"===b.op?"&&":"";e+="OR"===b.op?"||":"";e+=b.ruleStatus});$.each(d.rules,function(a,b){});try{itemSelect=eval(e)}catch(f){itemSelect=
!1}}itemSelect&&(gblFilteredData.push(d),gblBaselineCnt++,a=getRow(d),"string"===typeof d.category&&(d.category=[d.category]),-1<$.inArray("Childcare",d.category)&&$("#hsi_childcare").append(a),-1<$.inArray("Employment",d.category)&&$("#hsi_employment").append(a),-1<$.inArray("Housing",d.category)&&$("#hsi_housing").append(a),-1<$.inArray("Medical",d.category)&&$("#hsi_medical").append(a),"benefit"===(d.type||"")&&$("#hsi_benefit").append(a))});var b=!1;$.each(["#hsi_benefit","#hsi_childcare","#hsi_employment",
"#hsi_housing","#hsi_medical"],function(a,d){0===$(d).html().length?$('li[href="'+d+'"]').addClass("hide"):($(d).removeClass("active in"),$('li[href="'+d+'"]').removeClass("active"),$('li[href="'+d+'"]').removeClass("hide"),b||(b=!0,$(d).addClass("active in"),$('li[href="'+d+'"]').addClass("active")))});$("#hsi_searchresultscount").html(gblBaselineCnt+" Results Found.");resetSearch();$("#hsi_searchresults, #hsi_searchresultscount").removeClass("hide")}
function searchResults(){if(""===$("#hsi_searchtext").val())return resetSearch(),!0;var a=$("#hsi_searchtext").val(),b=0;$("#hsi_tabs").addClass("hide");$("#hsi_searchresults").html("");$.each(gblFilteredData,function(c,d){0<=JSON.stringify(d).toLowerCase().indexOf(a.toLowerCase())&&($("#hsi_searchresults").append(getRow(d)),b++)});$("#hsi_searchresultscount").html(b+" Results Found for '"+a+"'");$("#hsi_searchresults, #hsi_searchresultscount, #hsi_searchreset").removeClass("hide")}
function resetSearch(){$("#hsi_searchresults").html("");$("#hsi_searchresults, #hsi_searchreset").addClass("hide");$("#hsi_searchtext").val("");$("#hsi_tabs").removeClass("hide");$("#hsi_searchresultscount").html(gblBaselineCnt+" Results Found.")}
function getRow(a){var b;b="<div class='searchRecord row'><div class='hidden-xs col-sm-1 categoryicon'>";sIMG=-1<a.category.indexOf("Housing")?"housing.png":-1<a.category.indexOf("Childcare")?"childcare.png":-1<a.category.indexOf("Medical")?"medical.png":"employment.png";b+="<img src='img/"+sIMG+"' title ='"+a.category+"' alt='"+a.category+" icon'/>";b+="</div>";b+="<div class='col-xs-12 col-sm-6'>";b+="<h3><a href='"+a.link+"' target='_blank'>"+a.title+"</a></h3>";b+="<p>"+a.description+"</p>";b+=
"</div>";b+="<div class='col-xs-12 col-sm-4'>";sRLHTML="";"undefined"!==typeof a.relatedlinks&&0<a.relatedlinks.length&&$.each(a.relatedlinks,function(a,b){sRLHTML=0===a?"<h4>Related Links</h4><ul>":sRLHTML;sRLHTML+="<li><a href='"+b.link+"' target='_blank' >"+b.title+"</a></li>"});sRLHTML+=""!==sRLHTML?"</ul>":"";b+=sRLHTML;b+="</div>";"benefit"===(a.type||"")&&(b+="<div class='hidden-xs col-sm-1 subsidyicon'>",b+="<img src='img/benefit.png' title ='This item is a Subsidy/Benefit' alt='Subsidy/Benefit icon'/>",
b+="</div>");return b+="</div>"}
function setUpEvents(){$("#wizardSummary").on("keydown","#hsi_searchtext",function(a){a=a.charCode?a.charCode:a.keyCode?a.keyCode:0;13==a&&searchResults();27==a&&resetSearch()});$("#summarydetails").on("click","li a",function(a){var b=$(this).data("stepid");goToStep(b);a.preventDefault()});$("#summarydetails").on("click","li",function(a){var b=$(this).find("a").data("stepid");goToStep(b);a.preventDefault()});$("#gotoTop").on("click",function(a){window.scrollTo(0,$("#hsi_tabs").offset().top);a.preventDefault()});
$(".nota").on("click",function(a){var b=$(this);b.prop("checked")&&$.each(b.parent().parent().find(":input:checked"),function(a,d){d.id!==b[0].id&&(console.log(d.id,b.id),$(d).prop("checked",!1))})});$(".notnota").on("click",function(a){a=$(this);a.prop("checked")&&$.each(a.parent().parent().find(".nota:checked"),function(a,c){$(c).prop("checked",!1)})})}function setUpQuestionAnswers(){$.each(gblRules,function(a,b){""!==b.value&&(questions[b.value]=!1)})}
function loadData(){var a=API_HOST+"/cc_sr_v1/data/"+APP_EVENT_TYPE+"_"+EVENT_TYPE_APPROVE_STATUS+"?limit=1000";gblJSONData=[];$.ajax({url:a,type:"GET",timeout:500,crossDomain:!0,dataType:"jsonp",success:function(a){gblJSONData=a.sort(dynamicSort("","title"))},error:function(a,c){appAlert("Application Error","We apologize but this application is not functioning properly. Please check again at a later date");console.log(a)}})}
function renderCFrame(){app.setBreadcrumb([]);app.includeFormValidation=app.includePlaceholders=app.includeMultiSelect=!0;app.render(showApp)}function showApp(){$("#maincontent").load("html/body.html #finderMain",function(){setUpEvents();$('[data-toggle="tooltip"]').tooltip()})}$(document).ready(function(){setUpQuestionAnswers();renderCFrame();loadData()});

function setPageStatus(e,t,s){$("#RowStart").html(e+1),t>s?$("#RowEnd").html(s):$("#RowEnd").html(t+1),$("#TotalRows").html(s);var a=Math.ceil(s/rowsPerPage);$("#numberPageSelection").bootpag({total:a})}function resetAdvancedFilters(){$(".filterSelect").each(function(e){$("#"+this.id).multiselect("selectAll",!1),$("#"+this.id).multiselect("refresh")}),$("#dateFrom").val(""),$("#dateTo").val(""),$("#wardFilter").val("0"),$("#wardFilter").multiselect("refresh"),$("#incHistory").prop("checked",!1)}function resetFilters(){resetAdvancedFilters(),$(".searchString").each(function(e){this.value=""})}function decodeMultSelection(e){var t="";return $(e).prop("options")&&$(e).prop("selectedOptions")&&$(e).prop("options").length===$(e).prop("selectedOptions").length?t="ALL":null!==$(e).val()&&$.each($(e).val(),function(e,s){t+=e>0?",":"",t+=s}),t}function mergeLocations(e){for(var t={},s=0;s<e.length;s++){var a={id:e[s].id,name:e[s].name,address:e[s].address,status:e[s].status,lastInspected:e[s].lastInspectionDate||null,lat:+e[s].latitude,latlng:new google.maps.LatLng(e[s].latitude,e[s].longitude),lng:+e[s].longitude};t[a.latlng.toString()]||(t[a.latlng.toString()]={address:a.address,establishments:[],lat:a.lat,latlng:a.latlng,lng:a.lng}),t[a.latlng.toString()].establishments.push({id:e[s].id,name:e[s].name,status:e[s].status,lastInspected:e[s].lastInspectionDate})}return t}function clearMarkers(){for(var e=0;e<mapMarkers.length;e++)mapMarkers[e].setMap(null);mapMarkers=[]}function plotMarkers(e){locations=mergeLocations(e);for(var t in locations){for(var s=locations[t],a=s.latlng,i=s.establishments.length>1?0:parseInt(s.establishments[0].status,10),n="[",o=0;o<s.establishments.length;o++)n+='{ "id": '+s.establishments[o].id+"},";n=n.slice(0,-1)+"]";var r=s.establishments.length>1?s.establishments.length+" Establishments":s.establishments[0].name,l=new google.maps.Marker({position:a,map:map,estIds:n,icon:markerImages[i],title:r});l.addListener("click",function(){var e=$.parseJSON(this.estIds);processInfoWindow(e,this.position)}),mapMarkers.push(l)}}function toggleKMLLayer(){kmlLayer.setMap(kmlLayer.getMap()?null:map)}function redrawMap(e){$("#map-loader").show(),mapSrc="Markers",kmlLayer.setMap(null),clearMarkers(),$.ajax({type:"GET",url:searchEstURL+e,crossDomain:!0,dataType:"jsonp",success:function(e){plotMarkers(e),$("#map-loader").hide()},error:function(e,t,s){console.log(e.status),console.log(s)}})}function resetMapToKML(){"KML"!=mapSrc&&($("#map-loader").show(),clearMarkers(),kmlLayer.setMap(map),mapSrc="KML")}function generateListing(){var e=!1,t="",s=nextRow+rowsPerPage-1,a=$("#estSearch").val(),i=$("#addrSearch").val(),n=dataUrl+"&iDisplayStart="+nextRow+"&iDisplayLength="+rowsPerPage,o=decodeMultSelection("#statusFilter");"ALL"!==o?(t+="&status="+o,e=!0):t+="&status=1,2,3",""!==a&&(t+="&name="+a,e=!0),""!==i&&(t+="&address="+i,e=!0);var r=decodeMultSelection("#estTypeFilter");"ALL"!==r&&(t+="&type="+r,e=!0);var l=$("#wardFilter").val();"0"!==l&&(t+="&ward="+l,e=!0),$("#incHistory").prop("checked")&&(t+="&checkInspectionHistory=true",e=!0);var c=$("#dateFrom").val(),p=$("#dateTo").val();""!==c&&(t+="&from="+moment(c).format(TPH_API_DATE_FORMAT),e=!0),""!==p&&(t+="&to="+moment(p).format(TPH_API_DATE_FORMAT),e=!0),$.ajax({type:"GET",url:n+t,crossDomain:!0,dataType:"jsonp",success:function(e){setPageStatus(nextRow,s,e.iTotalRecords),loadListView(e)},error:function(e,t,s){console.log(e.status),console.log(s)}}),e?redrawMap(t):resetMapToKML()}function switchToStreetView(e){var t=map.getStreetView(),s=e.replace("(","").replace(")","").split(","),a=new google.maps.StreetViewService,i=50,n=new google.maps.LatLng(s[0],s[1]);a.getPanoramaByLocation(n,i,function(e,s){s===google.maps.StreetViewStatus.OK?(t.setPosition(e.location.latLng),t.setPano(e.location.pano),t.setPov({heading:google.maps.geometry.spherical.computeHeading(e.location.latLng,n),zoom:1,pitch:0}),t.setVisible(!0)):alert("No street view available for this location")})}function showLinkOnMap(e,t,s){var a=map.getStreetView();a.getVisible()&&a.setVisible(!1);var i=new google.maps.LatLng(t,s);map.setZoom(13),map.setCenter(i),estArr=[],estArr.push({id:e}),processInfoWindow(estArr,i)}function loadListView(e){var t="";$.each(e.aaData,function(e,s){t+="<tr id='dinerow"+e+"'>",t+="<td style='text-align:center' class='col-md-1'><img src='"+statusIcons[s[0]]+"'></td>",t+="<td class='col-md-5'><a href='#' onclick='showLinkOnMap("+s[4]+","+s[5]+","+s[6]+")'>"+s[1]+"</a></td>",t+="<td class='col-md-3'>"+s[2]+"</td>",t+="<td class='col-md-3'>"+s[3]+"</td>",t+="</tr>"}),t=""===t?"<tr><td colspan='4'>No Establishment found, check search options and try again</td></tr>":t,$("#dinetable tbody").html(t).trigger("update");$("#dineTable").tablesorter({theme:"blue",widthFixed:!1,widgets:["filter"],widgetOptions:{filter_columnFilters:!0,filter_cssFilter:"",filter_childRows:!1,filter_ignoreCase:!0,filter_reset:".reset",filter_searchDelay:300,filter_startsWith:!1,filter_hideFilters:!1}})}function reorgInfractions(e){var t="MUNICIPAL",s=e.date.split("-"),a={date:new Date(+s[0],+s[1]-1,+s[2]),foodInfractions:[],municipalInfractions:[],status:e.status};for(var i in e.infractions){var n=e.infractions[i];i==t?a.municipalInfractions=n:a.foodInfractions.push({category:i,details:n.sort(function(e,t){return+e.severity<+t.severity?-1:+e.severity>+t.severity?1:0})})}return a}function popInfractionTable(e){var t=["Crucial","Significant","Minor"],s="";if(e.foodInfractions.length>0){s+="<div class='table-responsive'><table class='table table-bordered'>",s+="<thead><tr><th class='FPRI"+e.status+"' colspan='4'>Food Premises Regulation Infractions</th></tr>",s+="<tr><th>Category</th><th>Severity</th><th>Action</th><th>Outcome</th></tr></thead>",s+="<tbody>";for(var a=0;a<e.foodInfractions.length;a++){s+="<tr><td colspan='4' class='infractionCat'>"+e.foodInfractions[a].category+"</td></tr>";for(var i=0;i<e.foodInfractions[a].details.length;i++)s+="<tr><td>"+e.foodInfractions[a].details[i].details+"</td>",s+="<td><span class='inSeverity"+e.foodInfractions[a].details[i].severity+"'>"+t[e.foodInfractions[a].details[i].severity-1]+"<span></td>",s+="<td>"+e.foodInfractions[a].details[i].action+"</td>",e.foodInfractions[a].details[i].prosecutions.length>0?(s+="<td>",e.foodInfractions[a].details[i].prosecutions[0].outcome&&(s+=e.foodInfractions[a].details[i].prosecutions[0].outcome),e.foodInfractions[a].details[i].prosecutions[0].date&&(s+="<br/>"+e.foodInfractions[a].details[i].prosecutions[0].date),e.foodInfractions[a].details[i].prosecutions[0].fine&&(s+="<br/>$"+e.foodInfractions[a].details[i].prosecutions[0].fine),s+="</td>"):s+="<td></td>",s+="</tr>"}s+="</tbody></table></div>"}if(e.municipalInfractions.length>0){s+="<div class='table-responsive'><table class='table table-bordered'>",s+="<thead><tr><th class='munInfCat' colspan='3'><span class='munInf'>Municipal Code Infractions</span></th></tr><tr><th>Category</th><th>Action</th><th>Outcome</th></tr></thead>",s+="<tbody>";for(var n=0;n<e.municipalInfractions.length;n++)s+="<tr><td>"+e.municipalInfractions[n].details+"</td>",s+="<td>"+e.municipalInfractions[n].action+"</td>",s+="<td>"+e.municipalInfractions[n].prosecutions+"</td>",s+="</tr>";s+="</tbody></table></div>"}return s}function setupDetailsModal(e){var t=["No infractions were observed under the Food Premises Regulation during an inspection.","One or more significant infractions were observed under the Food Premises Regulation during an inspection.","One or more crucial infractions were observed under the Food Premises Regulation that present an immediate health hazard that cannot be corrected during an inspection."],s=["Immediate health hazard|These infractions must be corrected immediately. An order to close the premises may be issued and/or immediate action must be taken to remove or eliminate the health hazard. A Closed Notice will be issued and must be posted, and other enforcement action will be taken. Crucial infractions are conditions that endanger food directly, such as contamination, time-temperature abuse or lack of safe-to-drink water or any other condition that constitutes a health hazard.","Potential health hazard|These infractions must be corrected immediately and a re-inspection to check for compliance will be conducted within 24 to 48 hours. Legal action may be taken should these infractions remain outstanding. Under exceptional circumstances a re-inspection to check for compliance may be extended beyond 48 hours. Significant infractions concern food handling, preparation, storage and/or service.","Minimal health risk|These Infractions must be corrected immediately. A follow-up compliance check will be conducted at the next scheduled inspection."];$("#estName").text(e.name),$("#estAddress").text(e.address),$("#estType").text(e.type),$("#minInspection").text(e.minimumInspections);var a="<h3>Inspection Criteria</h3><div>Every establishment receives a minimum of 1, 2, or 3 inspections each year depending on the specific type of establishment, the food preparation processes, volume and type of food served and other related criteria.</div>";$("#numInspTT").tooltip({placement:"bottom",html:!0,title:a});for(var i="",n=0;n<e.inspections.length;n++)i+="<div id='ins_"+n+"' class=''>",i+="<h3 class='leading'>",i+="<img src='"+statusIcons[e.inspections[n].status]+"' alt='"+statusIconsAlt[e.inspections[n].status]+"'>",i+="<span class='date'> "+moment(e.inspections[n].date).format(DISPLAY_DATE_FORMAT)+" - </span>",1===e.inspections[n].status?i+="<span class='inspectionStatus'>Pass</span></h3>":2===e.inspections[n].status?i+="<span class='inspectionStatus'>Conditional Pass</span></h3>":3===e.inspections[n].status&&(i+="<span class='inspectionStatus'>Closed</span></h3>"),inspection=reorgInfractions(e.inspections[n]),1==+inspection.status&&inspection.foodInfractions.length>0||(i+="<p class='description'>"+t[+inspection.status-1]+"</p>"),i+=popInfractionTable(inspection),i+="</div>";$("#inspections").html(i);for(var o=0;o<s.length;o++){var r=s[o].split("|"),l="<h3>"+r[0]+"</h3><div>"+r[1]+"</div>";$(".inSeverity"+(o+1)).tooltip({placement:"bottom",html:!0,title:l})}var c="<h3>No Health Hazard</h3><div>It should be noted that while the majority of infractions pertain to the requirements under the food premisses regulation, there are some infractions that pertain to the requirements under municipal by-laws. In such cases, the infraction severity does not apply.<div>";$(".munInf").tooltip({placement:"bottom",html:!0,title:c}),$("#submitComplaintId").click(function(){dineSafeComplaint.init()})}function createInfoWindow(e,t){CommonInfoWindow.close(),$("#map-loader").hide();var s="";if(1===selectedEstablishmentData.length)selectedEstablishmentData[0].inspections.length>0&&(s="<div class='infoCol1'><img src='"+statusIcons[selectedEstablishmentData[0].inspections[0].status]+"'></div>"),s+="<div class='infoCol2'><span class='infoImportant'><a href='#' onclick='showInspectionDetails("+selectedEstablishmentData[0].id+")'>"+selectedEstablishmentData[0].name+"</a></span><br>",s+=selectedEstablishmentData[0].address+"<br>",s+="Last Inspected: "+(selectedEstablishmentData[0].inspections.length>0?moment(selectedEstablishmentData[0].inspections[0].date).format(DISPLAY_DATE_FORMAT):"")+"</div>",s+="<div class='infoFooter'><a href='#' onclick='showInspectionDetails("+selectedEstablishmentData[0].id+")'><img src='"+inspectionsIcon+"' alt='Inspection Details'></a>",s+="<a class='svLink' ref='#' onclick='switchToStreetView(\""+e+"\")'><img src='"+streetViewIcon+"' alt='StreetView'></a></div>";else{s="<div class='infoHeader'><span class='infoImportant'>"+selectedEstablishmentData[0].address+"</span><br>"+selectedEstablishmentData.length+" establishments at this address</div>";for(var a=0;a<selectedEstablishmentData.length;a++)s+="<div class='infoMultiRow'>",selectedEstablishmentData[a].inspections.length>0?(s+="<div class='infoCol1'><img src='"+statusIcons[selectedEstablishmentData[a].inspections[0].status]+"'></div>",s+="<div class='infoCol2'><span class='infoImportant'><a onclick='showInspectionDetails("+selectedEstablishmentData[a].id+")' href='#'>"+selectedEstablishmentData[a].name+"</a></span>",s+="<br>Last Inspected: "+(selectedEstablishmentData[a].inspections.length>0?moment(selectedEstablishmentData[a].inspections[0].date).format(DISPLAY_DATE_FORMAT):"")+" ",s+="<a style='margin-left: 10px;' href='#' onclick='showInspectionDetails("+selectedEstablishmentData[a].id+")'><img src='"+inspectionsIcon+"' alt='Inspection Details'></a>"):(s+="<div class='infoCol1'><img src='"+statusIcons[0]+"'></div>",s+="<div class='infoCol2'><span class='infoImportant'><a onclick='showInspectionDetails("+selectedEstablishmentData[a].id+")' href='#'>"+selectedEstablishmentData[a].name+"</span></a>"),s+="</div></div>";s+="<a class='svLink' href='#' onclick='switchToStreetView(\""+e+"\")'><img src='"+streetViewIcon+"' alt='StreetView'></a></div>"}CommonInfoWindow.setOptions({position:e,pixelOffset:0,content:s}),CommonInfoWindow.open(map)}function processInfoWindow(e,t){$("#map-loader").show();var s=[];console.log(e),selectedEstablishmentData=[];for(var a=0;a<e.length;a++){var i=detailURL+e[a].id;console.log(i);var n=$.ajax({type:"GET",url:i,crossDomain:!0,dataType:"jsonp",success:function(e){selectedEstablishmentData.push(e)},error:function(e,t,s){console.log(e.status),console.log(s)}});s.push(n)}$.when.apply(null,s).done(function(){createInfoWindow(t,selectedEstablishmentData,e.length)})}function showInspectionDetails(e){for(var t="",s=0;s<selectedEstablishmentData.length;s++)selectedEstablishmentData[s].id===e&&(t=selectedEstablishmentData[s],setupDetailsModal(t));$("#inspectionDetails").modal("show")}function loadKmlLayer(e,t){kmlLayer=new google.maps.KmlLayer(e,{suppressInfoWindows:!0,preserveViewport:!0,map:t}),kmlLayer.set("preserveViewport",!0),google.maps.event.addListener(kmlLayer,"click",function(e){$("#map-loader").show();var t=$.parseJSON(e.featureData.info_window_html);processInfoWindow(t,e.latLng)}),google.maps.event.addListener(kmlLayer,"status_changed",function(){kmlLayer.getStatus()==google.maps.KmlLayerStatus.OK?$("#map-loader").hide():alert("kmlLayer load failed")})}function doSearch(){nextRow=0,$("#numberPageSelection").bootpag({page:1}),generateListing()}function setUpEvents(){$("#numberPageSelection").bootpag({total:rowsPerPage,page:1,maxVisible:5,leaps:!0,firstLastUse:!0,first:"←",last:"→",wrapClass:"pagination",activeClass:"active",disabledClass:"disabled",nextClass:"next",prevClass:"prev",lastClass:"last",firstClass:"first"}).on("page",function(e,t){nextRow=(t-1)*rowsPerPage,generateListing()}),$("#pageSize").multiselect({buttonWidth:"75px",buttonClass:"pull-right",onChange:function(e,t,s){rowsPerPage=Number($("#pageSize").val()),$("#numberPageSelection").bootpag({page:1}),nextRow=0,generateListing()}}),$("#pageSize").next().css({"float":"right"}),$(".hasclear").keyup(function(){var e=$(this);e.next("span").toggle(Boolean(e.val()))}),$(".clearer").hide($(this).prev("input").val()),$(".clearer").click(function(){$(this).prev("input").val("").focus(),$(this).hide()}),$("#searchBtn").click(function(){doSearch()}),$(".searchString").keypress(function(e){var t=e.which||e.keyCode||0;13!==t&&9!==t||doSearch()}),$("#advSearchApplyBtn").on("click",function(){$("#modalSearch").modal("hide"),doSearch()}),$("#resetAdvSearchBtn").on("click",function(){resetAdvancedFilters()}),$("#resetBtn").on("click",function(){resetFilters(),generateListing()})}function resetMap(){map.setZoom(11),map.setCenter(torontoCenter),CommonInfoWindow.close()}function handleNoGeolocation(e){e===!0?(alert("Geolocation service failed."),initialLocation=newyork):(alert("Your browser doesn't support geolocation. We've placed you in Siberia."),initialLocation=siberia),map.setCenter(initialLocation)}function initApp(){$("#map-loader").show(),map=new google.maps.Map(document.getElementById("map-canvas"),{center:torontoCenter,zoom:11,mapTypeId:google.maps.MapTypeId.TERRAIN,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.TOP_RIGHT},zoomControl:!0}),loadKmlLayer(src,map),map.setZoom(11);var e=document.getElementById("resetMap");e.onclick=function(){resetMap()},map.controls[google.maps.ControlPosition.RIGHT_TOP].push(e),$("#resetMap").css({right:"8px"});var t=document.getElementById("pac-input"),s=new google.maps.places.SearchBox(t);map.controls[google.maps.ControlPosition.TOP_LEFT].push(t),map.addListener("bounds_changed",function(){s.setBounds(map.getBounds())});var a=[];s.addListener("places_changed",function(){var e=s.getPlaces();if(0!==e.length){a.forEach(function(e){e.setMap(null)}),a=[];var t=new google.maps.LatLngBounds;e.forEach(function(e){var s={url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};a.push(new google.maps.Marker({map:map,icon:s,title:e.name,position:e.geometry.location})),e.geometry.viewport?t.union(e.geometry.viewport):t.extend(e.geometry.location)}),map.fitBounds(t),map.setZoom(14)}}),map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(document.getElementById("legend")),navigator.geolocation&&(browserSupportFlag=!0,navigator.geolocation.getCurrentPosition(function(e){initialLocation=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),map.setCenter(initialLocation),map.setZoom(13)},function(){})),$("#estTypeFilter").multiselect({includeSelectAllOption:!0,numberDisplayed:1,buttonWidth:"100%",enableCollapsibleOptGroups:!0}),$("#statusFilter").multiselect({includeSelectAllOption:!0,numberDisplayed:1,buttonWidth:"100%"}),$("#wardFilter").multiselect({includeSelectAllOption:!0,buttonWidth:"100%"}),$(".input-daterange").datepicker({todayBtn:!0,forceParse:!1,autoclose:!0,format:"yyyy-mm-dd",date:new Date,todayHighlight:!0}),setUpEvents(),generateListing();$("table").tablesorter()}function loadPage(){var e="";0===document.location.hostname.length?(e+='<link rel="stylesheet" href="js/datepicker/datepicker.css">',e+='<link rel="stylesheet" href="static_files/assets/css/bootstrap-multiselect.css">',e+='<link rel="stylesheet" href="tablesorter/css/theme.blue.css">',e+='<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css">',e='<link rel="stylesheet" href="static_files/assets/validator/bootstrapValidator.min.css">',e+='<link rel="stylesheet" href="css/dineSafe.css">',e+='<script type="text/javascript" src="static_files/assets/validator/bootstrapValidator.min.js"></script>',e+='<script type="text/javascript" src="tablesorter/js/jquery.tablesorter.js"></script>',e+='<script type="text/javascript" src="tablesorter/js/jquery.tablesorter.widgets.js"></script>',e+='<script type="text/javascript" src="static_files/assets/multiselect/bootstrap-multiselect.js"></script>',e+='<script type="text/javascript" src="static_files/assets/datepicker/bootstrap-datepicker.js"></script>',e+='<script type="text/javascript" src="static_files/assets/datepicker/moment-with-locales.js"></script>',e+='<script type="text/javascript" src="js/jquery.bootpag.min.js"></script>',e+='<script type="text/javascript" src="/placeholders/placeholders.min.js"></script>',$("#appCodeMap").html(e),$("#appDisplayMap").load("html/dineSafeListing.html",function(){initApp()})):(e+='<link rel="stylesheet" href="datepicker/datepicker.css">',e+='<link rel="stylesheet" href="/static_files/assets/multiselect/bootstrap-multiselect.css">',e+='<link rel="stylesheet" href="/tablesorter/css/theme.blue.css">',e+='<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css">',e='<link rel="stylesheet" href="/static_files/assets/validator/bootstrapValidator.min.css">',e+='<link rel="stylesheet" href="/static_files/WebApps/Health/DineSafe/css/dineSafe.css">',e+='<script type="text/javascript" src="/static_files/assets/validator/bootstrapValidator.min.js"></script>',e+='<script type="text/javascript" src="/tablesorter/js/jquery.tablesorter.js"></script>',e+='<script type="text/javascript" src="/tablesorter/js/jquery.tablesorter.widgets.js"></script>',e+='<script type="text/javascript" src="/static_files/assets/multiselect/bootstrap-multiselect.js"></script>',e+='<script type="text/javascript" src="/datepicker/bootstrap-datepicker.js"></script>',e+='<script type="text/javascript" src="/static_files/assets/datepicker/moment-with-locales.js"></script>',e+='<script type="text/javascript" src="/placeholders/placeholders.min.js"></script>',e+='<script type="text/javascript" src="/static_files/assets/pagination/jquery.bootpag.min.js"></script>',$("#appCodeMap").html(e),$("#appDisplayMap").load("/static_files/WebApps/Health/DineSafe/html/dineSafeListing.html",function(){initApp()}))}var detailURL="https://secure.toronto.ca/dinesafe/getEstablishmentDetails.json?callback=?&ESTABLISHMENT_ID=",dataUrl="https://secure.toronto.ca/dinesafe/dataTableEstablishments.json?callback=?",searchEstURL="https://secure.toronto.ca/dinesafe/searchEstablishments.json?callback=?",rowsPerPage=10,nextRow=0,TPH_API_DATE_FORMAT="MM/DD/YYYY",DISPLAY_DATE_FORMAT="MMMM DD, YYYY",CommonInfoWindow=new google.maps.InfoWindow,selectedEstablishmentData=[],statusIcons=["/static_files/WebApps/Health/DineSafe/images/map/blank.png","/static_files/WebApps/Health/DineSafe/images/map/pass.png","/static_files/WebApps/Health/DineSafe/images/map/conditional.png","/static_files/WebApps/Health/DineSafe/images/map/close.png"],statusIconsAlt=["no 0 status","pass","pass conditional","close"],markerImages=["/static_files/WebApps/Health/DineSafe/images/map/marker_multi.png","/static_files/WebApps/Health/DineSafe/images/map/marker_pass.png","/static_files/WebApps/Health/DineSafe/images/map/marker_conditional.png","/static_files/WebApps/Health/DineSafe/images/map/marker_close.png"],streetViewIcon="/static_files/WebApps/Health/DineSafe/images/map/streetView.png",inspectionsIcon="/static_files/WebApps/Health/DineSafe/images/map/inspections.png",map,masterMap,mapSrc="KML",kmlLayer,mapMarkers=[],torontoCenter=new google.maps.LatLng(43.69666,-79.39274),randKey=(new Date).valueOf(),src="https://docs.google.com/uc?id=0B-j2Y49nfiw2dTRlazc5ak9jU00&rand="+randKey;$(document).ready(function(){loadPage()});